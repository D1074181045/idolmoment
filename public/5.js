(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"4gOU":function(t,e,a){"use strict";a.r(e);var n=a("v9aq"),s=!0,i=!1,c={data:function(){return{message:"",chat_messages:[]}},components:{msg:n.a},computed:{chat_ban:function(){return this.$store.state.ban_type.chat},create_msg_disabled:function(){return this.$store.state.ban_type.chat.status},api_prefix:function(){return this.$store.state.api_prefix},cool_down:function(){return this.$store.state.cool_down}},updated:function(){if(i){if(s){var t=document.getElementsByTagName("tbody")[0];t.scrollTop=t.scrollHeight}i=!1}},mounted:function(){var t=this,e=document.getElementsByTagName("tbody")[0];e.onscroll=function(){var t=e.scrollHeight-e.scrollTop;s=t<=e.offsetHeight},Echo.channel("public-chat-channel").listen(".public-chat-event",(function(e){var a=e.name,n=e.nickname,s=e.message,c=e.chat_created_at;"chatroom"===t.$route.name&&(t.chat_messages.push({name:a,nickname:n,message:s,created_at:c}),i=!0)}))},activated:function(){var t=this;document.title="聊天室";var e=this.api_prefix.concat("get-chats");this.$store.commit("cool_down","chat"),axios.get(e).then((function(e){var a=e.status,n=e.chat_messages;a&&(t.chat_messages=n)})).then((function(){var t=document.getElementsByTagName("tbody")[0];t.scrollTop=t.scrollHeight}))},methods:{create_message:function(){var t=this;if(!this.create_msg_disabled){var e=this.api_prefix.concat("create-message");this.chat_ban.status=!0,axios.post(e,{message:this.message}).then((function(e){var a=e.status,n=e.chat_time;a?(t.cool_down.chat=n,t.$store.commit("cool_down","chat")):t.chat_ban.status=!1})).catch((function(e){t.chat_ban.status=!1})),this.message=""}},timeStampToDateTime:function(t){var e=new Date(t),a=e.getFullYear(),n=e.getMonth()+1;n=n<10?"0"+n.toString():n;var s=e.getDate();s=s<10?"0"+s.toString():s;var i=e.getHours();i=i<10?"0"+i.toString():i;var c=e.getMinutes();c=c<10?"0"+c.toString():c;var o=e.getSeconds();return a+"-"+n+"-"+s+" "+i+":"+c+":"+(o=o<10?"0"+o.toString():o)},create_enter:function(){var t=this;document.onkeydown=function(e){13===e.keyCode&&t.create_message()}}}},o=(a("Zu0U"),a("KHd+")),r=Object(o.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tb",on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.create_enter(e)}}},[a("h3",[t._v("聊天室")]),t._v(" "),a("table",{staticClass:"table table-hover",staticStyle:{"margin-top":"1rem"}},[t._m(0),t._v(" "),a("tbody",t._l(t.chat_messages,(function(e){return a("tr",[a("td",{staticStyle:{width:"150px"}},[a("router-link",{staticStyle:{"font-size":"12px"},attrs:{to:{name:"profile",params:{name:e.name}},exact:""}},[t._v(t._s(e.nickname))])],1),t._v(" "),a("td",[t._v(t._s(e.message))]),t._v(" "),a("td",{staticStyle:{width:"160px"}},[t._v(t._s(t.timeStampToDateTime(e.created_at)))])])})),0)]),t._v(" "),t.chat_ban.time?a("msg",{staticStyle:{"margin-bottom":"10px"}},[t._v("剩餘時間："+t._s(t.chat_ban.time))]):t._e(),t._v(" "),a("div",{staticClass:"setting"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.message},on:{input:function(e){e.target.composing||(t.message=e.target.value)}}}),t._v(" "),a("button",{staticClass:"btn btn-primary",staticStyle:{width:"15%"},attrs:{type:"button",disabled:t.create_msg_disabled},on:{click:t.create_message}},[t._v("送出")])])],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("thead",{staticClass:"thead-light"},[e("tr",[e("th",{staticStyle:{width:"150px"}},[this._v("暱稱")]),this._v(" "),e("th",[this._v("訊息")]),this._v(" "),e("th",{staticStyle:{width:"160px"}},[this._v("時間")])])])}],!1,null,"7a7632c4",null);e.default=r.exports},Zu0U:function(t,e,a){"use strict";a("fcT6")},dcnM:function(t,e,a){(t.exports=a("I1BE")(!1)).push([t.i,"\ntable tbody[data-v-7a7632c4] {\n    display: block;\n    max-height: 500px;\n    overflow-y: scroll;\n    -webkit-appearance: none;\n}\ntable thead[data-v-7a7632c4], tbody tr[data-v-7a7632c4] {\n    display: table;\n    width: 100%;\n    table-layout: fixed;\n}\ntable tbody tr td[data-v-7a7632c4] {\n    word-break: break-all;\n}\ntable thead[data-v-7a7632c4] {\n    width: calc(100% - 1em)\n}\n@media screen and (max-width: 600px) {\ntable thead[data-v-7a7632c4] {\n        width: calc(100%)\n}\n}\n",""])},fcT6:function(t,e,a){var n=a("dcnM");"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};a("aET+")(n,s);n.locals&&(t.exports=n.locals)},v9aq:function(t,e,a){"use strict";var n;a.d(e,"a",(function(){return c}));var s,i,c=a("nFaw").a.div(n||(s=["\n    color: #9A0000;\n"],i||(i=s.slice(0)),n=Object.freeze(Object.defineProperties(s,{raw:{value:Object.freeze(i)}}))))}}]);